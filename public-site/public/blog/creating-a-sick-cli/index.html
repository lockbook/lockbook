<!DOCTYPE html>
<html>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

<!-- Disable zooming: -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<head>
    <title>lockbook</title>

    <!-- <link data-trunk rel="copy-file" href="assets/sw.js"/> -->
    
    
    

    <!-- <link data-trunk rel="rust" data-wasm-opt="2" /> -->


    <link rel="stylesheet" href="/tailwind-24b4eb6d7c88acfe.css" integrity="sha384&#x2D;ueh1SlfmPyj6FbJnsdusPjmyu8YkfaOUvNccfYZdMrvx3PSJEgyqfJofUz9MCR&#x2F;z"/>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Martian+Mono:wght@100..800&display=swap" rel="stylesheet" />
    
    <style>
        html {
            /* Remove touch delay: */
            touch-action: manipulation;
        }
        
        /* Allow canvas to fill entire web page: */
        html,
        body {
            overflow: hidden;
            margin: 0 !important;
            padding: 0 !important;
            height: 100%;
            width: 100%;
        }
    </style>
<link rel="modulepreload" href="/public-site-2215c5060d0d0045.js" crossorigin=anonymous integrity="sha384-NGQf3F/Fn4bAgj/embM0Yesb066qXr6t7z5XHTVbV9PDOH+riNdQrVbZY8DKC1gt"><link rel="preload" href="/public-site-2215c5060d0d0045_bg.wasm" crossorigin=anonymous integrity="sha384-XOIFU03s2S7ltHgPGxviQZNga0IcMNLWnckAC8njRgbB7p/qMrWnP1BO7iA8VxgQ" as="fetch" type="application/wasm"></head>

<body class="overflow-x-hidden overflow-y-scroll bg-abyss-900">
    <nav class="sticky top-0 z-40 px-10 py-4 overflow-scroll border-b-2 max-sm:pr-0 text-egshell bg-abyss-900/80 border-abyss-400 backdrop-blur-md">
        <div class="flex justify-between w-full align-middle">
            <div class="flex"><a class="flex" href="/"><img src="/logo.svg" alt="lockbook's logo" class=""/></a></div>
            <div class="flex items-center">
                <ul class="flex mr-10 max-sm:hidden">
                    <a class="block mx-3 text-sm underline font-extralight" href="https://github.com/lockbook/lockbook" target="_blank">GitHub</a>
                    <a class="block mx-3 text-sm underline font-extralight" href="/#pricing" >Pricing</a>
                    <a class="block mx-3 text-sm underline font-extralight" href="/blog" target="_blank">Blog</a>
                </ul>
                <a class="px-6 py-2 text-sm font-bold text-abyss-900 bg-surfline" href="/#download">Download</a>
                <button data-expanded="false" class="relative mx-6 text-4xl bottom-1 text-surfline sm:hidden" id="nav-hamburger-btn">≡</button>
            </div>
        </div>
        <div>
            <ul class="flex-col hidden mt-10 mr-16 " id="mobile-nav-links">
                <a class="block mt-6 text-sm underline font-extralight" href="https://github.com/lockbook/lockbook" target="_blank">GitHub</a>
                <a class="block mt-6 text-sm underline font-extralight" href="/#pricing" target="_blank">Pricing</a>
                <a class="block mt-6 text-sm underline font-extralight" href="/blog" target="_blank">Blog</a>
            </ul>
        </div>
    </nav>
    

<div id="blog-content"class="max-w-2xl mx-auto my-24 text-egshell">
  <h1 class="title">
    Creating a sick CLI
  </h1>
  <p class="subtitle"><strong>2019-11-27</strong></p>
  <p>At <a href="https://parth.cafe/p/introducing-lockbook">Lockbook</a> we strongly believe in <a href="https://en.wikipedia.org/wiki/Eating_your_own_dog_food">dogfooding</a>. So we knew alongside a great, native, markdown editing experience we would want a <em>sick</em> CLI. Having a <em>sick</em> CLI creates interesting opportunities for a niche type of user who is familiar with a terminal environment:</p>
<ul>
<li>
<p>They can use the text editor they're deeply familiar with.</p>
</li>
<li>
<p>They can write scripts against their Lockbook.</p>
</li>
<li>
<p>They can vastly reduce the surface area of attack.</p>
</li>
<li>
<p>Can always maintain remote access to their Lockbook via SSH.</p>
</li>
</ul>
<p>In this post I’m going to tackle 3 topics:</p>
<ol>
<li>
<p>What makes a CLI sick?</p>
</li>
<li>
<p>How do you go about realizing some of those “interesting opportunities” using our CLI?</p>
</li>
<li>
<p>What’s next for our CLI?</p>
</li>
</ol>
<h1 id="what-makes-a-cli-sick">What makes a CLI <em>sick</em>?</h1>
<p>It’s tab completions. For me, tab completions are what I use to initially explore what a CLI can do. Later, if the CLI is <em>sick</em> , I use tab completions to speed up my workflow. I don’t just want to tab complete the structure of the CLI (subcommands and flags). I want to tab complete dynamic values, in Lockbook's case, this means completing file paths and IDs.</p>
<p><a href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F520d4b31-50c4-4c07-8e35-38b1bcb2f3d6_946x374.png"><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F520d4b31-50c4-4c07-8e35-38b1bcb2f3d6_946x374.png" alt="" /></a></p>
<p><a href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F77563e15-d3ac-4e85-84b1-27c341b598f0_1034x370.png"><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F77563e15-d3ac-4e85-84b1-27c341b598f0_1034x370.png" alt="" /></a></p>
<p>If you're creating a CLI most libraries make you choose between a few bad options:</p>
<ul>
<li>
<p>Hand-craft completion files for each shell.</p>
</li>
<li>
<p>Sacrifice dynamic completions and just settle for automatically generated static completions.</p>
</li>
</ul>
<p>Rust is no exception here, <code>clap</code> has some support for static completions, but no way to invoke dynamic completions without writing a completion file for each shell.</p>
<p>And so we set out to solve this problem for the Rust ecosystem, and created <code>cli-rs</code>. A parsing library, similar to <code>clap</code> but with explicit design priorities around creating a great tab completion experience. As soon as <code>cli-rs</code> was stable enough we re-wrote <code>lockbook</code>'s CLI using it so we could pass on these gains to our users</p>
<p><a href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F7cebb737-4276-46df-a78f-316541b49aac_1266x952.png"><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F7cebb737-4276-46df-a78f-316541b49aac_1266x952.png" alt="" /></a></p>
<p><a href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fd281cadb-328d-4495-ad53-727caef8bdd1_1022x320.png"><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fd281cadb-328d-4495-ad53-727caef8bdd1_1022x320.png" alt="" /></a></p>
<p>Cli-rs is simple, you describe your CLI like this:</p>
<p><a href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F17154cfe-9918-4f99-a460-20838e1bb009_1346x640.png"><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F17154cfe-9918-4f99-a460-20838e1bb009_1346x640.png" alt="" /></a></p>
<p>This gives the parser all the information it needs to offer the best tab completion behavior. It handles all the static completions internally and then invokes your program when it’s time to dynamically populate a field with your user’s data.</p>
<p>We also invested a ton of effort in the infrastructure that deploys our CLI to our customer's machines so that tab completions would be set up for most people by default.</p>
<h1 id="exciting-opportunities-for-power-users">Exciting Opportunities for Power Users</h1>
<h2 id="use-your-favorite-text-editor">Use your favorite text editor</h2>
<p>You can <code>lockbook edit</code> any path you have access to and our CLI will invoke <code>vim</code>, utilizing any custom <code>.vimrc</code> that may exist. You can override the selected editor by setting the <code>LOCKBOOK_EDITOR</code> env var or using the <code>--editor</code> flag. So far we support <code>vim</code>, <code>nvim</code>, <code>subl</code>, <code>code</code>, <code>emacs</code> and <code>nano</code>.</p>
<p><a href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fdf94e90e-2daa-4f44-ac88-69c71d50a4e3_1266x952.png"><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fdf94e90e-2daa-4f44-ac88-69c71d50a4e3_1266x952.png" alt="" /></a></p>
<p>If we don’t support your favorite editor, send us a PR or hop in our <a href="https://markdowntohtml.com/TODO">discord</a> and tell us.</p>
<h2 id="extending-lockbook">Extending Lockbook</h2>
<p>We want Lockbook to be maximally extensible, this extensibility will take many forms, one of which is our CLI. Let's explore some of the interesting things you can accomplish with our CLI.</p>
<p>Let’s say you wanted a snapshot of everything in your second brain decrypted and without any proprietary format for tin-foil-hat backup reasons. You can easily set a <code>cron</code> that will simply <code>lockbook sync</code> and <code>lockbook backup</code> however often you want. <code>lockbook export</code> can be used to write any folder or document from Lockbook to your file system, paving the way for automated updates of a blog. Edit a note on your phone, and see the change live on your blog in seconds. <code>lockbook import</code> lets you do the opposite. Want to continuously back up a folder from your computer to Lockbook? Setup a <code>cron</code> that will simply <code>Lockbook import</code> and then <code>lockbook sync</code>.</p>
<p><a href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F3227172c-f7b8-4412-a5eb-a7ebc742b224_924x416.png"><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F3227172c-f7b8-4412-a5eb-a7ebc742b224_924x416.png" alt="" /></a></p>
<h2 id="ultra-secure">Ultra secure</h2>
<p>I like to think about security as the product of a few numbers. So if, for example, you’re product is closed source, one of those numbers in your multiplication chain is a big fat zero. And there’s nothing you can do to pretend it’s secure. Similarly, the age of a product is one of those numbers. Newer is worse, and this is one of Lockbook’s current weaknesses.</p>
<p>But one of Lockbook’s strengths is how much you can reduce the total amount of code it takes to interact with Lockbook. On one end of the spectrum, you have software that <strong>requires</strong> a full browser installation to perform the most basic tasks. Slightly better than that is software that runs natively, and on the other end of the spectrum is software that doesn’t even rely on a UI library. This is where our CLI comes into play: if you wanted to run Lockbook on a libre-booted Thinkpad running an ultra-minimal operating system, Lockbook wouldn’t require you to add the Google Chrome dependency tree to your setup.</p>
<h2 id="remote-lockbook">Remote Lockbook</h2>
<p>Sometimes you find yourself employed by a financial institution that heavily restricts what you can do on their machines. Without thinking too much more about your situation you may want to simply add something to your grocery list without pulling out your phone. Unfortunately, IT has locked down your remote Windows 7 installation, and not only can you not install our Windows app (which does not require administrator privileges to install) but you cannot visit GitHub itself!</p>
<p>Maybe in this environment, it’s not worth it to update your grocery list, but you identify with the likes of Ron Swanson, and you will not be defeated by your IT department. How? Because you port forwarded your desktop and memorized a lengthy SSH password. So you ssh in, use your favorite text editor, and you update that grocery list. There’s no stopping you.</p>
<h1 id="what-s-next-for-our-cli">What’s next for our CLI</h1>
<p>Our CLI has come a long way, we've experimented with various ways of allowing you to quickly find a note and edit it. In the past we experimented with piping output to programs like <code>fzf</code>, we even tried implementing a custom full-screen search. This is the approach that feels the best to us and we think is going to stand the test of time. But work is never done, so here are some of the things we plan to tackle in our CLI:</p>
<ul>
<li>
<p>Make cli-rs easier for others to use by adding documentation and examples.</p>
</li>
<li>
<p>Continue to invest in our release infrastructure to bring our CLI to more package managers. If you'd like to become a maintainer for a particular distro <a href="https://discord.gg/lockbook">reach out!</a>.</p>
</li>
<li>
<p>Support richer parser inputs including variable number of arguments, grouped command line flags, and logical de-duplication of tab completions (this flag or argument is already specified so don't suggest it again).</p>
</li>
<li>
<p>Deeper integrations with shells in <code>cli-rs</code>: offer ways to express that this argument is a normal file with completions, or implement mechanisms to re-write the current prompt (<code>lockbook edit sick&lt;tab&gt;</code> tab completes: <code>lockbook edit writing/parth.cafe/creating-a-sick-cli.md</code> presently tab completion options must begin with the current prompt).</p>
</li>
<li>
<p>A richer showcase of interesting things we can do with our CLI, we plan to set up our blog the way I described above and provide concrete examples of how to do many of the things I outlined. So if you haven't already subscribe to the <a href="https://blog.lockbook.net/">Lockbook Blog</a>, and <a href="https://www.youtube.com/@lockbook_net">Lockbook Youtube Channel</a>.</p>
</li>
</ul>
  
</div>


<style>
  #blog-content{
    h2, h3, h4 {
        font-weight: 400;
    }
    h1, h2, h3, h4, h5, p {
        margin-bottom: 24px;
        padding: 0;
    }
    h1 {
        font-size: 35px;
        font-weight: bold;
    }
    h2 {
        font-size: 30px;
        margin: 24px 0 6px;
    }
    h3 {
        font-size: 24px;
    }
    h4 {
        font-size: 21px;
    }
    h5 {
        font-size: 18px;
    }
    a {
        color: #28CCDF; /* should be the same as surfline in tailwind.config.js */
        margin: 0;
        padding: 0;
        text-decoration: none;
        vertical-align: baseline;
    }
    a:hover {
        text-decoration: underline;
    }
    a:visited {
        opacity: 0.7
    }
    ul, ol {
        padding: 0;
        margin: 0;
    }
    li {
        line-height: 24px;
    }
    li ul, li ul {
        margin-left: 24px;
    }
    p, ul, ol {
        font-size: 13px;
        line-height: 24px;
    }
    pre {
        padding: 0px 24px;
        white-space: pre-wrap;
    }
    code {
        font-family: Consolas, Monaco, Andale Mono, monospace;
        line-height: 1.5;
        font-size: 13px;
    }
    aside {
        display: block;
        float: right;
        width: 390px;
    }
    blockquote {
        border-left:.5em solid #eee;
        padding: 0 2em;
        margin-left:0;
    }
    blockquote  cite {
        font-size:14px;
        line-height:20px;
        color:#bfbfbf;
    }
    blockquote cite:before {
        content: '\2014 \00A0';
    }

    blockquote p {  
        color: #666;
    }
    hr {
        width: 540px;
        text-align: left;
        margin: 0 auto 0 0;
        color: #999;
    }
}
</style>


<script type="module" nonce="LaF5/v5sumGufc0zx2whKQ==">
import init, * as bindings from '/public-site-2215c5060d0d0045.js';
const wasm = await init({ module_or_path: '/public-site-2215c5060d0d0045_bg.wasm' });


window.wasmBindings = bindings;


dispatchEvent(new CustomEvent("TrunkApplicationStarted", {detail: {wasm}}));

</script></body>

<script>
    let navBurgerBtn = document.querySelector("#nav-hamburger-btn")
    let nav = document.querySelector("nav");
    let navLinks = document.querySelector("#mobile-nav-links");
    
    navBurgerBtn.addEventListener('click', e=>{
        navNeedsExpansion = navBurgerBtn.dataset.expanded === "false" ? true : false
        navBurgerBtn.dataset.expanded = navNeedsExpansion

        let expandedNavStyles =["h-screen"] 

        if (navNeedsExpansion) {
            nav.classList.add(...expandedNavStyles)
            navLinks.classList.remove("hidden");
            navLinks.classList.add("flex");
            navBurgerBtn.textContent = "x"
            document.body.classList.remove("overflow-y-scroll")
            document.body.classList.add("overflow-hidden")
        } else {
            nav.classList.remove(...expandedNavStyles)
            navLinks.classList.add("hidden");
            navLinks.classList.remove("flex");  
            navBurgerBtn.textContent = "≡"
            document.body.classList.add("overflow-y-scroll")
            document.body.classList.remove("overflow-hidden")
        }

    })
</script>

</html>